<!DOCTYPE html>
<html lang="en">
<link rel="stylesheet" href="https://bootswatch.com/5/cyborg/bootstrap.min.css">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600&display=swap" rel="stylesheet">
<link rel="icon"
    href="https://cdn-icons.flaticon.com/png/512/4906/premium/4906292.png?token=exp=1646321866~hmac=f681d04669f67218566710c9546312ca" />

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
    <title>URL Shortner</title>
</head>

<style>
    .container {
        font-family: 'Montserrat', sans-serif;
        padding-top: 100px;
    }

    #bottom {
        padding-bottom: 10px;
        position: fixed;
        bottom: 0;
    }

    #heading {
        padding-bottom: 25px;
    }

    #slug {
        margin-bottom: 30px;
    }
</style>

<body>
    <main class="container">
        <div id="slug"></div>
        <h1 id="heading"><img
                src="https://cdn.discordapp.com/attachments/795689556569096192/948984194703458334/4906292.png"
                width="90">URL Shortner</h1>
        <form>
            <div class="mb-3">
                <label class="form-label">Shorten your link</label>
                <input type="text" class="form-control" id="input" placeholder="Your URL here">
            </div>
            <div class="mb-3">
                <input type="text" class="form-control" id="input_slug" placeholder="Your custom slug here (Optional)">
            </div>
        </form>
        <button id="button_clicker" type="button" class="btn btn-dark">Shorten</button>
    </main>
    <script>
        async function click() {

            const slug = document.getElementById("input_slug").value ?? null;

            if (slug) {
                if (slug.length > 10) {
                    const div = document.getElementById("slug");
                    const emoji = document.createElement("i");
                    emoji.className = "bi bi-exclamation-circle-fill";
                    emoji.style.fontSize = "15px"
                    div.textContent = "The slug is more than 10 characters in length ";
                    div.style.fontSize = "15px";
                    div.style.fontWeight = 'bold'
                    div.className = "alert alert-danger align-items-center";
                    div.role = "alert";

                    div.append(emoji);
                    return;
                };
                const regex = new RegExp("^[a-zA-Z]*$");
                if (!regex.test(slug)) {
                    const div = document.getElementById("slug");
                    const emoji = document.createElement("i");
                    emoji.className = "bi bi-exclamation-circle-fill";
                    emoji.style.fontSize = "15px"
                    div.textContent = "The slug contains spaces, special characters and (or) numbers ";
                    div.style.fontSize = "15px";
                    div.style.fontWeight = 'bold'
                    div.className = "alert alert-danger align-items-center";
                    div.role = "alert";

                    div.append(emoji);
                    return;
                }
            }
            const element = document.getElementById("input");
            if (!element.value) {

                const div = document.getElementById("slug");
                const emoji = document.createElement("i");
                emoji.className = "bi bi-exclamation-circle-fill";
                emoji.style.fontSize = "15px"
                div.textContent = "No URL specified! ";
                div.style.fontSize = "15px";
                div.style.fontWeight = 'bold'
                div.className = "alert alert-danger align-items-center";
                div.role = "alert";

                div.append(emoji);
                return;
            }

            const regex = new RegExp("((http|https)://)(www.)?[a-zA-Z0-9@:%._\\+~#?&//=]{2,256}\\.[a-z]{2,6}\\b([-a-zA-Z0-9@:%._\\+~#?&//=]*)");

            if (!regex.test(element.value)) {
                const div = document.getElementById("slug");
                const emoji = document.createElement("i");
                emoji.className = "bi bi-exclamation-circle-fill";
                emoji.style.fontSize = "15px"
                div.textContent = "Invalid URL provided! ";
                div.style.fontSize = "15px";
                div.style.fontWeight = 'bold'
                div.className = "alert alert-danger align-items-center";
                div.role = "alert";

                div.append(emoji);
                return;
            }

            const data = await fetch("/urls/create", {
                method: "POST",
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ url: element.value, slug: slug })
            }).then(res => res.json());

            if (!data.slug) {
                const div = document.getElementById("slug");
                const emoji = document.createElement("i");
                emoji.className = "bi bi-exclamation-circle-fill";
                emoji.style.fontSize = "15px"
                div.textContent = "Provided slug is already in use! ";
                div.style.fontSize = "15px";
                div.style.fontWeight = 'bold'
                div.className = "alert alert-danger align-items-center";
                div.role = "alert";

                div.append(emoji);
                return;
            };

            const div = document.getElementById("slug");
            div.innerHTML = `You have successfully created a short link! See <a href=<%= url %>${data.slug} target="_blank"><%= url %>${data.slug}</a><br>I have also copied the link to your clipboard`;
            div.className = "alert alert-primary align-items-center";
            div.role = "alert";

            navigator.clipboard.writeText(`<%= url %>${data.slug}`);
        };
        document.getElementById("button_clicker").addEventListener("click", click); </script>
</body>

</html>